FROM node:20-alpine

# Install global dependencies
RUN npm install -g @nestjs/cli

WORKDIR /app

# Copy package files first for better Docker layer caching
COPY package*.json ./
COPY tsconfig*.json ./
COPY nest-cli.json ./

# Clear npm cache and install all dependencies
RUN npm cache clean --force
RUN npm install --verbose

# Create node_modules as a volume mount point
RUN mkdir -p /app/node_modules

# Copy source code
COPY . .

EXPOSE 8080

# Use nodemon for development with proper watching
CMD ["npm", "run", "start:dev"] 